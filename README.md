# -
同济大学软件学院2022年春操作系统课程项目
2054321 陈亮奇
运行Traffic_clq.exe文件即可执行程序（需保证exe文件与img文件夹（存有图片资源）同根平级，否则程序无法正常加载图片）。
src文件夹下为源代码。
除exe外，OS_1/out/artifacts/OS_1_jar文件夹下的jar包也可以在命令行下执行java -jar命令执行。


1.界面设计

注：以界面中向上视为实际中向北

①界面左上角显示从程序运行开始计时到现在经过的时间（最多支持程序运行100000秒）。
②界面右下角通过点击车辆切换想要添加的车辆类型（单选按钮-四选一）。
③十字路口中间共四盏交通灯，如③所示为向北行驶的车辆所看到的红绿灯。即当前时刻，南北向道路为绿灯，东西向道路为红灯。
④用于添加车辆的按钮，如④所示为添加向北行驶车辆所用按钮；该按钮按下后需等待1秒后才可再次按下；当该道路因各种因素（如遇红灯）导致界面中车辆添加已满时，该按钮不可用。

2.功能设计
①总体算法设计
本项目需要实现十字路口交通灯控制机制。当用户按下添加按钮后，开启一个新进程，实现车辆从按钮位置沿指定方向前进，在斑马线前进行判断，若对应交通灯不为绿灯或者当前十字路口中心有垂直向车辆正在行驶时阻塞自身进程，等到交通灯变为绿灯且十字路口中心无垂直向车辆行驶时继续执行自身进程，沿原方向行驶至界面外时，结束进程。
第一辆私家车行驶进程的状态转换图如下：

注：对于第二个及之后的车辆，在行驶至路口前还需对前方车辆状态进行判断，若前方有车辆停止则自身也立刻进入等待状态，当前方车辆前进时，状态转换图同上。

②车辆行驶算法设计
车辆前进实现：进程每间隔83ms（一帧）改变车辆图片的所在坐标（一次函数表示对应X或Y坐标），从而实现车辆前进的动画效果。
车辆等待实现：根据速度调整时间使车辆恰好行驶至斑马线前时（或前方有车辆时恰好行驶至前一车辆后方一段距离），对当前路口红绿灯状态及路口中心状态进行判断（或对前方车辆进行判断），若交通灯不为绿灯，或者路口中心存在垂直向车辆正在行驶（或前方车辆已停止），则阻塞进程（调用内含Sleep方法的while循环以实现进程阻塞效果），此时该进程正运行while循环，无法运行车辆前进方法，从而实现车辆等待效果。
另：对于非私家车，该过程中不对红绿灯状态进行判断，当前方无车辆阻挡时，即时此时对应交通灯为红灯，仍然正常向前行驶。
③交通灯切换算法设计
程序开启时，主函数开启while循环，该循环内第一句为Sleep(1000)，表示该循环体每1秒执行一次，接下来使变量count自增1，用以表示当前时间，随后对count变量进行判断：由于单一交通灯以绿灯8秒，随后黄灯2秒，最后红灯10秒的方式不断循环，所以对count变量模20运算，根据结果判断当前四个交通灯状态，切换对应图片并为记录交通灯状态的变量进行赋值即可。

3.运行展示
①南北向红灯、东西向绿灯时：

此时东西向车辆正常依次行驶，南北向车辆依次等待。

②南北向绿灯、东西向红灯，但东西向道路先有一警车驶过时：

由于警车率先驶入路口中心，南北向车辆即使对应绿灯，但仍需要等待警车驶离路口中心再前进。
当警车驶离路口后，十字路口状态如图：

④南北向黄灯、东西向红灯时：

尽管向西的道路中有紧急情况的救护车可以无视红灯，但其前方的私家车则必须等待红灯结束再前进，因此救护车需要排在私家车后方，等待前方私家车前进后再跟进。
当东西向转为绿灯时，十字路口状态如图：

④南北向红灯、东西向绿灯，且东西向道路中车辆正常行驶时：

此时南北向道路中有一救护车行驶至路口，尽管救护车紧急情况可以无视红灯，但前方东西向车辆正在正常行驶，因此救护车需要进行等待，当前方东西向车辆全部离开路口中心时再前进。
当东西向车辆全部离开路口中心，且南北向仍为红灯时，十字路口状态如图：

需要向南行驶的私家车继续等待红灯，有紧急情况的救护车无视红灯直接前进。


